<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel</title>
  <link rel="stylesheet" href="style.css">
  <!-- Firebase -->
  <!-- Inclua firebase.js acima -->
</head>
<body>
  <div class="painel">
    <div class="relogio">
      <div id="hora"></div>
      <div>Good morning</div>
    </div>

    <div class="calendario">
      <div id="mesAno"></div>
      <table id="gradeCalendario"></table>
    </div>

    <div class="clima">
      <div id="temp">--°</div>
      <div id="desc">...</div>
    </div>

    <div class="foto"><img id="carrossel" src="" alt="Foto"></div>

    <div class="todo">
      <h3>To-do</h3>
      <ul id="tarefas"></ul>
    </div>

    <div class="agenda">
      <h3>Agenda</h3>
      <ul id="agenda"></ul>
    </div>
  </div>

<script>
  // Relógio
  function atualizaHora() {
    var agora = new Date();
    document.getElementById('hora').innerText = agora.toLocaleTimeString();
  }
  setInterval(atualizaHora, 1000);
  atualizaHora();

  // Clima
  var apiKey = 'YOUR_OPENWEATHERMAP_API_KEY';
  fetch('https://api.openweathermap.org/data/2.5/weather?q=Sao Paulo&units=metric&appid=' + apiKey)
    .then(function(r){ return r.json(); })
    .then(function(d){
      document.getElementById('temp').innerText = Math.round(d.main.temp) + '°';
      document.getElementById('desc').innerText = d.weather[0].description;
    });

  // Mensagem
  firebase.database().ref('mensagemAtual').on('value', function(snap){
    var msg = snap.val();
    if (msg && msg.som) {
      var beep = new Audio('https://www.soundjay.com/button/beep-07.wav');
      beep.play();
      setTimeout(function(){ beep.pause(); }, 5000);
    }
  });

  // Tarefas
  firebase.database().ref('tarefas').on('value', function(snap){
    var ul = document.getElementById('tarefas');
    ul.innerHTML = '';
    snap.forEach(function(child){
      var li = document.createElement('li');
      li.textContent = child.val().texto;
      ul.appendChild(li);
    });
  });

  // Agenda (Eventos próximos) — simula lista
  var hoje = new Date();
  var agenda = document.getElementById('agenda');
  for (var i = 0; i < 15; i++) {
    var dia = new Date();
    dia.setDate(hoje.getDate() + i);
    var li = document.createElement('li');
    li.textContent = dia.toDateString() + ' — Evento';
    agenda.appendChild(li);
  }

  // Carrossel de fotos
  var fotos = [];
  firebase.storage().ref('fotos').listAll().then(function(res){
    res.items.forEach(function(item){
      item.getDownloadURL().then(function(url){
        fotos.push(url);
      });
    });
  });

  var idx = 0;
  function trocaFoto(){
    if(fotos.length > 0){
      document.getElementById('carrossel').src = fotos[idx];
      idx = (idx + 1) % fotos.length;
    }
  }
  setInterval(trocaFoto, 5000);
</script>
</body>
</html>
