<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel Calendário</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #111;
      color: #fff;
    }
    .painel {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      padding: 20px;
    }
    .bloco {
      background: #222;
      padding: 15px;
      border-radius: 10px;
    }
    table {
      width: 100%;
      text-align: center;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>

<div class="painel">
  <div class="bloco">
    <h3>Calendário</h3>
    <div id="mesAno"></div>
    <table id="gradeCalendario"></table>
  </div>

  <div class="bloco">
    <h3>Agendamentos</h3>
    <ul id="detalhesAgendamentos"></ul>
  </div>
</div>

<script>
  var firebaseConfig = {
    apiKey: "AIzaSyAa_IPmOWZ4-KpWIC7huhhl7mYjYfEJhDk",
    authDomain: "diphouse-control.firebaseapp.com",
    databaseURL: "https://diphouse-control-default-rtdb.firebaseio.com",
    projectId: "diphouse-control",
    storageBucket: "diphouse-control.firebasestorage.app",
    messagingSenderId: "126387069829",
    appId: "1:126387069829:web:7e365252a98da884075aec"
  };
  firebase.initializeApp(firebaseConfig);
  var db = firebase.database();

  var categorias = {
    "Saúde": "#28a745",
    "Trabalho": "#007bff",
    "Lazer": "#ffc107"
  };

  function renderCalendario(agendamentos) {
    var now = new Date();
    var mes = now.getMonth();
    var ano = now.getFullYear();

    document.getElementById('mesAno').innerText = now.toLocaleString('default', { month: 'long' }) + ' ' + ano;

    var primeiro = new Date(ano, mes, 1).getDay();
    var diasMes = new Date(ano, mes + 1, 0).getDate();

    var dias = ['S','T','Q','Q','S','S','D'];
    var tabela = '<tr>';
    for (var d = 0; d < dias.length; d++) {
      tabela += '<th>' + dias[d] + '</th>';
    }
    tabela += '</tr><tr>';

    for (var i = 0; i < primeiro; i++) tabela += '<td></td>';

    for (var dia = 1; dia <= diasMes; dia++) {
      var dataStr = ano + '-' + String(mes + 1).padStart(2,'0') + '-' + String(dia).padStart(2,'0');
      var cor = '';

      for (var ag in agendamentos) {
        if (agendamentos[ag].data === dataStr) {
          cor = categorias[agendamentos[ag].categoria] || '#fff';
          break;
        }
      }

      var style = '';
      if (cor) style = ' style="background:' + cor + ';border-radius:50%;"';

      tabela += '<td' + style + '>' + dia + '</td>';

      if ((dia + primeiro) % 7 === 0) tabela += '</tr><tr>';
    }

    document.getElementById('gradeCalendario').innerHTML = tabela + '</tr>';
  }

  function listarDetalhes(agendamentos) {
    var lista = document.getElementById('detalhesAgendamentos');
    lista.innerHTML = '';

    var now = new Date();
    var mes = now.getMonth() + 1;

    for (var ag in agendamentos) {
      var data = agendamentos[ag].data;
      var detalhe = agendamentos[ag].detalhe;

      if (parseInt(data.split('-')[1]) === mes) {
        var li = document.createElement('li');
        li.textContent = data + ' - ' + detalhe;
        lista.appendChild(li);
      }
    }
  }

  db.ref('agendamentos').on('value', function(snapshot) {
    var agendamentos = {};
    snapshot.forEach(function(child) {
      agendamentos[child.key] = child.val();
    });

    renderCalendario(agendamentos);
    listarDetalhes(agendamentos);
  });
</script>

</body>
</html>
